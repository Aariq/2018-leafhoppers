---
title: "Total polyphenols"
output: html_notebook
---

Total polyphenols were measured by Amma Agyei using the Folin-Ciocalteau assay Spring of 2019.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(car)
library(janitor)
library(cowplot)
```

# Read in data

```{r}
tp <- read_csv(here("data", "raw", "2017 total polyphenols.csv"))
```

These data are means of triplicate runs.  Amma hasn't sent me the raw data yet

```{r}
tp <- clean_names(tp)
tp
```

- Sample: cultivar (all were Qing Xin Da Mao in 2017)
- Standard Deviation: from averaging triplicates
- Polyphenols: galic acid equivalents in mg/mL (i think)
- Coefficient of Variation: from averaging triplicates
- Density: leafhopper density at end of experiment in insects/young leaf
- mg tea: mg of tea powder
- mg/g GAE: galic acid equivalents in mg/g of tea powder

# Regression


Plotting the data makes me think there is a quadratic relationship, so I'll test for that.

```{r}
m1 <- lm(mg_g_gae ~ poly(density, 2), data = tp)
m2 <- lm(mg_g_gae ~ density, data = tp)
m0 <- lm(mg_g_gae ~ 1, data = tp)
AIC(m1, m2, m0)
summary(m1)
Anova(m1)
```

Looks like best model is intercept only, although polynomial is maybe better than linear.

Model diagnostics:

```{r}
shapiro.test(tp$mg_g_gae)
#normal enough
```

## Plot results:

```{r}
p <-
  ggplot(tp, aes(x = density, y = mg_g_gae)) +
  geom_point() +
  geom_smooth(method = "lm", formula = "y ~ poly(x, 2)", se = FALSE)
p
```

Seems like that value under 4 could be an outlier.

```{r}
tp %>% filter(mg_g_gae < 4)
# tp
```
It has a really low coefficient of variation though, so probably not. Ah well, I guess I can say there is a slight trend toward a quadratic relationship?


# Prettier plot

```{r}
p.polished <-
  p +
  labs(x = "Final leafhopper density (insects / shoot)",
       y = "Total polyphenols (mg/g GAE)") +
  theme_bw() +
  annotate(geom = "text", x = 1.1, y = 4, label = "p = 0.093")

p.polished
save_plot(here("figs", "2017 total polyphenols.png"), p.polished, base_aspect_ratio = 1.5)
```


